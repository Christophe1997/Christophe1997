<!DOCTYPE html>
<html>
  <head>
    
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-112755173-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
      
  Effective Java 2 &ndash; CastOff

    </title>
    
    
    <meta name="description" property="og:description" content="&amp;ldquo;effective Java&amp;quot;的第二部分总结, 内容主要关于Object的可重写的方法(equals, toString, hashCode, clone, finalize)以及类和接口的使用。 Ob|">
    

    <meta name="apple-mobile-web-app-title" content="CastOff">
    
    
    <link rel="icon" href="/favicon-64.png">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="mask-icon" size="any" href="/pinned-icon.svg">
    
    
    

    <meta name="msvalidate.01" content="A66009ECF32987EBBB7783F428A03342" />
    <link rel="stylesheet" href="/assets/syntax.css">
    <link rel="stylesheet" href="/assets/primer-build.css">
    <link rel="stylesheet" href="/assets/style.css">
  </head>


  <body class="bg-gray">
    <div id="holy" class="container-lg bg-white h-100">

      <div id="header" class="px-1 bg-white">
        <nav class="UnderlineNav UnderlineNav--right px-2">
  <a class="UnderlineNav-actions muted-link h2" href="https://christophe1997.github.io">
    CastOff
  </a>

  
  
  <div class="UnderlineNav-body">
    
    
    
    <a class="UnderlineNav-item " href="/posts/">
      
      <span>Blogs</span>
    </a>
    
    
    
    
    <a class="UnderlineNav-item " href="/">
      
      <span>About</span>
    </a>
    
    
  </div>
  
</nav>

      </div>

      <div role="main" id="main" class="holy-main markdown-body px-4 bg-white">
        

<div class="Subhead">
  <div class="Subhead-heading">
    <div class="h1 mt-3 mb-1">Effective Java 2</div>
  </div>
  <div class="Subhead-description">
    


<a href='/categories/notes' class="muted-link">
  <span class="Label Label--gray-darker">Notes</span>
</a>



<a href='/tags/java' class="muted-link">
  <span class="Label Label--gray">Java</span>
</a>



    
    <div class="float-md-right">
      <span title="Lastmod: 2020-06-11. Published at: 2020-06-05.">
        
          Lastmod: 2020-06-11
        
      </span>
    </div>
    
  </div>
</div>
<article>
  
  <section class="pb-6 mb-3 border-bottom">
    <p>&ldquo;effective Java&quot;的第二部分总结, 内容主要关于<code>Object</code>的可重写的方法(<code>equals</code>, <code>toString</code>, <code>hashCode</code>, <code>clone</code>, <code>finalize</code>)以及类和接口的使用。</p>
<h2 id="object">Object中可重写的方法</h2>
<h3 id="equals">equals实现等价关系</h3>
<p>意味着其要满足自反性, 对称性和传递性, 同时还应该保持一致性, 另外对于任何对象, <code>x.equals(null) == false</code>. 通常一个<code>equals</code>方法满足以下几条:</p>
<ol>
<li>用<code>==</code>检查是否是同一个引用, 如果是, 返回<code>true</code>;</li>
<li>用<code>instanceof</code>检查是否了正确的类型, 如果不是, 返回<code>false</code>;</li>
<li>类型转换;</li>
<li>检查满足逻辑等价的字段.</li>
</ol>
<p>重写<code>equals</code>的同时也需要重写<code>hashCode</code>, 可以使用<a href="https://github.com/google/auto/tree/master/value">AutoValue</a>或者<a href="https://github.com/rzwitserloot/lombok">Lombok</a>自动生成代码.</p>
<h3 id="tostring">总是重写toString</h3>
<h3 id="clone">谨慎的重写clone</h3>
<p>一个类只有实现了<code>Cloneable</code>, 其<code>clone</code>方法才是合法的, 否则会抛出<code>CloneNotSupportedException</code>, <code>clone</code>的约束是创建并返回一个该对象的拷贝, 也就是说</p>
<ol>
<li><code>x.clone() != x -&gt; true</code></li>
<li><code>x.clone().getClass() == x.getClass() -&gt; true</code></li>
<li><code>x.clone().equals(x) -&gt; true</code>(可选)</li>
</ol>
<p>实现<code>clone</code>方法时, 首先调用<code>super.clone</code>, 如果类的字段都是primitive或者是不可变对象, 此时方法的实现就结束了, 否则, 还需要对每一个可变对象的字段递归的调用<code>clone</code>(有没法递归调用的情况). 而实际上, 除了数组以外, 其他情况下使用具有copy语义的构造函数或静态工厂方法通常是一个比<code>clone</code>更好的选择.</p>
<h3 id="comparable">Comparable实现序关系</h3>
<p>可以用<code>Comparator</code>来实现<code>compareTo</code>.</p>
<h2 id="heading">类和接口</h2>
<h3 id="heading1">最小化类和成员的访问权限</h3>
<ul>
<li>尽可能的使类和成员不可访问，即采取必要时放宽的策略, 即一开始, 除了定义的API外其他都应该是私有的;</li>
<li>顶层的类和接口两个访问级别: <em>package-private</em>, <em>public</em>;</li>
<li>成员四个访问级别: <em>private</em>, <em>package-private</em>, <em>protected</em>(子类和package中的其他类能够访问), <em>public</em>;</li>
</ul>
<h3 id="publicgettersetter">public的类使用getter/setter</h3>
<h3 id="immutable">Immutable</h3>
<ul>
<li>没有修改对象状态的方法(如setter);</li>
<li>保证类无法被继承;</li>
<li>所有字段为<em>final</em>;</li>
<li>所有字段为<em>private</em>;</li>
<li>尽可能的保证类的不可变, 否则限制其可变性;</li>
<li>尽可能的声明所有字段为<code>private final</code>.</li>
</ul>
<h3 id="heading2">偏向组合而不是继承</h3>
<ul>
<li>用一个中间的<em>forwarding class</em>(包装, 仅仅转发原始类的方法)实现复用(装饰模式);</li>
<li>为继承提供良好的设计和文档.</li>
</ul>
<h3 id="heading3">偏向接口而不是抽象类</h3>
<h3 id="heading4">接口只用于提供类型</h3>
<h3 id="heading5">嵌套类偏向于静态的</h3>
<ul>
<li>如果一个嵌套类不需要访问实例非公有的方法和字段, 使用<code>static</code>.</li>
</ul>
<h2 id="heading6">总结</h2>
<p>这两部分总的看下来除了最小化访问权限外没啥意外.</p>

  </section>

  <section>
    
      
    
  </section>
</article>

      </div>

      <div id="side" class="pr-1 bg-white">
        <aside class="pr-3">
          
  
    <div id="toc" class="Box Box--blue mb-3">
      <b>Effective Java 2</b><nav id="TableOfContents">
  <ul>
    <li><a href="#object">Object中可重写的方法</a>
      <ul>
        <li><a href="#equals">equals实现等价关系</a></li>
        <li><a href="#tostring">总是重写toString</a></li>
        <li><a href="#clone">谨慎的重写clone</a></li>
        <li><a href="#comparable">Comparable实现序关系</a></li>
      </ul>
    </li>
    <li><a href="#heading">类和接口</a>
      <ul>
        <li><a href="#heading1">最小化类和成员的访问权限</a></li>
        <li><a href="#publicgettersetter">public的类使用getter/setter</a></li>
        <li><a href="#immutable">Immutable</a></li>
        <li><a href="#heading2">偏向组合而不是继承</a></li>
        <li><a href="#heading3">偏向接口而不是抽象类</a></li>
        <li><a href="#heading4">接口只用于提供类型</a></li>
        <li><a href="#heading5">嵌套类偏向于静态的</a></li>
      </ul>
    </li>
    <li><a href="#heading6">总结</a></li>
  </ul>
</nav></div>
  

  
    <div>
      
    </div>
  

        </aside>
      </div>

      <div id="footer" class="pt-2 pb-3 bg-white text-center">
        

  <span class="text-small text-gray">
    ©Christophe &middot; 

    Powered by the
    <a href="https://github.com/qqhann/hugo-primer" class="link-gray-dark">Hugo-Primer</a> theme for
    <a href="https://gohugo.io" class="link-gray-dark">Hugo</a>.
  </span>


      </div>
    </div>

    
    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>
    
  </body>
</html>
